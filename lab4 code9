CREATE VIEW TOP_MANAGERS12 AS
SELECT * FROM (
    SELECT
        m.EMPLOYEE_ID AS MANAGER_ID,
        m.FIRST_NAME || ' ' || m.LAST_NAME AS MANAGER_NAME,
        COUNT(e.EMPLOYEE_ID) AS NUM_EMPLOYEES_UNDER,
        AVG(e.SALARY) AS AVG_SALARY_UNDER
    FROM EMPLOYEES m
    JOIN EMPLOYEES e ON m.EMPLOYEE_ID = e.MANAGER_ID
    GROUP BY m.EMPLOYEE_ID, m.FIRST_NAME, m.LAST_NAME
    ORDER BY AVG(e.SALARY) DESC
)
WHERE ROWNUM <= 3;
